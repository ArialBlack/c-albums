<?php 

/**
* Implements hook_block_info().
*/

function coins_entity_view($entity, $type, $view_mode, $langcode) {
    if ($view_mode == 'teaser' && $entity->type == 'coin') {
        $entity->content['field_coin']['#items'] = array_slice($entity->content['field_coin']['#items'], 0, 2);
    }
}

function coins_block_info() {
  $blocks = array();
  $blocks['UserActions'] = array(
    'info' => t('User Actions'),
  );

  $blocks['UserCollection'] = array(
    'info' => t('User Collection'),
  );

  return $blocks;
}

/**
* Implements hook_block_view().
*/
function coins_block_view($delta = '') {
  $block = array();

  switch ($delta) {
    case 'UserActions':
      $block['subject'] = '';
      $block['content'] = _ua_block();
      break;

    case 'UserCollection':
      $block['subject'] = '';
      $block['content'] = _uc_block();
      break;
  }

  return $block;
}

function _ua_block() {
  $output = '<nav></nav><ul><li>' . l(t('Add coin'), '/node/add/coin', array('attributes' => array('class' => array('')))) . '</li>';
  $output = $output . '<li>' . l(t('Create album'), '/node/add/album', array('attributes' => array('class' => array('')))) . '</li></ul></nav>';
  return $output;
}

function _uc_block() {
  global $user;
  $username = $user->name;

  $output = '<nav></nav><ul><li>' . l(t('My albums'), '/user/' . $username  . '/albums', array('attributes' => array('class' => array('')))) . '</nav>';
  //$output = $output . '<li>' . l(t('Create album'), '/node/add/album', array('attributes' => array('class' => array('')))) . '</li></ul></nav>';
  return $output;
}

function coins_form_alter(&$form, &$form_state, $form_id) {
  if ($form['#id'] == 'views-exposed-form-mycoinslist-entityreference-view-widget-1') {

    $quartiers[] = array('ALL' => t('- Any -'));
    unset ($form['my_almum_title']);

    global $user;
    $current_user = $user->uid;

    $result = db_select('node', 'n')
      ->fields('n', array('title'))
      ->condition('n.type', 'album')
      ->condition('n.status', '1')
      ->condition('n.uid', $current_user)
      ->execute();

    $dropdown_array = array('' => t('- Any -'));

    foreach ($result as $node) {
      $dropdown_array[$node->title] = $node->title;
    }

    $form['my_almum_title'] = array(
      '#type' => 'select',
      '#default_value' => '1',
      '#options' => $dropdown_array,
    );
  }
}